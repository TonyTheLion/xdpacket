---
# scratch (new grammar attempt)
xdpk:
  # field: a set of bytes to be hashed or written
  - field: ip src addr
    offt: 0x1A
    len: 4
  - field: ip dst addr
    offt: 0x20
    len: 4
  - field: ip proto
    offt: 0x17
    len: 1


  # tag: a field and some corresponding value (to be hashed or written)
  - tag: icmp
    value: 0x02
  - tag: from joe
    field: ip src addr
    value: 192.168.0.1
  - tag: to joe
    field: ip dst addr
    value: 192.168.0.1

  - tag: from bill
    field: ip src addr
    value: 192.168.10.1
  - tag: to bill
    field: ip dst addr
    value: 192.168.10.1


  # action: some series of tranformations to be applied to a packet
  - action: spoof joe
    seq:
      - mangle: to bill
      - mangle: from joe
      - out: eth0
  - action: spoof bill
    seq:
      - mangle: to joe
      - mangle: from bill
      - out: eth0


  # matcher: a series of tags to match (in an and/or relationship)
  # matched with an action
  - matcher: joe
    and:
      - icmp
      - from joe
    do: spoof joe
  - matcher: bill
    and:
      - icmp
      - from bill
    do: spoof bill


  # iface
  # a physical interface, with a list of matchers for 'in' and 'out' directions
  - iface: eth0
    in:
      - joe
  - iface: eth1
    in:
      - bill
...
